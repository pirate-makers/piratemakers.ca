<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="Prune">
<meta name="description" content="Playing with ArgoCD ApplicationSets" />
<meta name="keywords" content="blog,developer,personal,cnc,shapeoko,maker,pirate,hacker,go,golang,devops,gitops, devops, argocd, gitops" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://piratemakers.ca/posts/2024/01/argocd-appset-of-appset-pattern/" />


    <title>
        
            ArgoCD Appset-of-Appset Pattern :: Pirate Makers 
        
    </title>





<link rel="stylesheet" href="https://piratemakers.ca/main.949191c1dcc9c4a887997048b240354e47152016d821198f89448496ba42e491.css" integrity="sha256-lJGRwdzJxKiHmXBIskA1TkcVIBbYIRmPiUSElrpC5JE=">


    
        <link rel="stylesheet" type="text/css" href="https://piratemakers.ca/css/custom.css">
    


    <link rel="apple-touch-icon" sizes="180x180" href="https://piratemakers.ca/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://piratemakers.ca/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://piratemakers.ca/favicon-16x16.png">
    <link rel="manifest" href="https://piratemakers.ca/site.webmanifest">
    <link rel="mask-icon" href="https://piratemakers.ca/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="https://piratemakers.ca/favicon.ico">
    <meta name="msapplication-TileColor" content="">


<meta itemprop="name" content="ArgoCD Appset-of-Appset Pattern">
<meta itemprop="description" content="Playing with ArgoCD ApplicationSets"><meta itemprop="datePublished" content="2024-01-10T14:31:56+00:00" />
<meta itemprop="dateModified" content="2024-01-10T10:38:08-05:00" />
<meta itemprop="wordCount" content="1400"><meta itemprop="image" content="https://piratemakers.ca/posts/2024/01/argocd-appset-of-appset-pattern/images/1.png" />
<meta itemprop="keywords" content="devops,argocd,gitops," />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://piratemakers.ca/posts/2024/01/argocd-appset-of-appset-pattern/images/1.png" /><meta name="twitter:title" content="ArgoCD Appset-of-Appset Pattern"/>
<meta name="twitter:description" content="Playing with ArgoCD ApplicationSets"/>



    <meta property="og:title" content="ArgoCD Appset-of-Appset Pattern" />
<meta property="og:description" content="Playing with ArgoCD ApplicationSets" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://piratemakers.ca/posts/2024/01/argocd-appset-of-appset-pattern/" /><meta property="og:image" content="https://piratemakers.ca/posts/2024/01/argocd-appset-of-appset-pattern/images/1.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-10T14:31:56+00:00" />
<meta property="article:modified_time" content="2024-01-10T10:38:08-05:00" />







    <meta property="article:published_time" content="2024-01-10 14:31:56 &#43;0000 UTC" />











    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="https://piratemakers.ca/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">&gt;</span>
            <span class="logo__text ">
                Pirate Makers</span>
            <span class="logo__cursor" style=
                  "visibility:hidden;
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://piratemakers.ca/posts/">Blog</a></li><li><a href="https://piratemakers.ca/about/">About</a></li><li><a href="https://piratemakers.ca/tags">Tags</a></li>
        <div class="submenu">
            <li class="dropdown">
                <a href="javascript:void(0)" class="dropbtn">en</a>
                <div class="dropdown-content">
                    
                        
                    
                </div>
            </li>
        </div>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
        </span>
    </span>
</header>


            <div class="content">
                
  <main class="post">

    <div class="post-info">
      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        7 minutes

        
      </p>
    </div>

    <article>
      <h1 class="post-title">
        <a href="https://piratemakers.ca/posts/2024/01/argocd-appset-of-appset-pattern/">ArgoCD Appset-of-Appset Pattern</a>
      </h1>

      
        <div class="post-excerpt">Playing with ArgoCD ApplicationSets</div>
      

      

      

      <div class="post-content">
        <p><img src="images/1.png#layoutTextWidth" alt="Docker Fail"></p>
<p>We all know the App-of-Apps pattern, where one repo contains many other <code>ArgoCD Applications</code>.</p>
<p>While testing how to add my Kubernetes Cluster&rsquo;s Addons using ArgoCD, which represents all the apps mandatory in all clustets, like crossplane, prometheus (victoriaMetrics), exporters&hellip;, I came to test a &ldquo;new&rdquo; pattern: <code>AppSet-Of-AppSet</code>.</p>
<p>This is a quick post going over my experiements. It is <strong>not</strong> a howto, or a suggestion to go this route, it&rsquo;s just a test.</p>
<h2 id="directory-structure">Directory Structure</h2>
<pre tabindex="0"><code>├── deployments
│   ├── argocd
│   │   └── qa.yaml
│   └── k8s
│       ├── addons
│       │   └── qa
│       │       └── qa-us-central-cluster
│       │           └── crossplane
│       │               └── kustomization.yaml
│       ├── base
│       │   ├── configmaps
│       │   │   ├── cm.yaml
│       │   │   └── kustomization.yaml
│       │   └── crossplane
│       │       ├── kustomization.yaml
│       │       ├── namespaces.yaml
│       │       ├── providers.yaml
│       │       └── values.yaml
│       ├── config.yaml
│       └── overlays
│           └── qa
│               └── qa-us-central-cluster
│                   └── crossplane.yaml
</code></pre><h2 id="original-appset">Original AppSet</h2>
<p>This is the AppSet scanning all my Git repos (Gitlab in this example) and generating Apps. This is classic, using a <code>Matrix</code> to create one app per cluster. It is not linked to deploying my Cluster Addons, it could also deploy any other apps, fron any repo.</p>
<p>In this case it is named <code>devops</code> as it will scann all the repos under <code>/devops</code> subgroup of my Gitlab Server. It will only track the <code>deployment</code> branch and will only pick repod with a <code>deployments/argocd/qa.yaml</code> file.<br>
If will then matrix the selected repos with two <code>git</code> generators:</p>
<ul>
<li>one <code>directory</code> looking for <code>deployments/k8s/overlays/qa/*</code> where <code>*</code> will be the cluster to target by the Application (<code>qa-us-central-cluster</code> from the tree above).</li>
<li>one <code>deployments/k8s/config.yaml</code> file, global to the repo, with some MANDATORY values in it. It is mandatory as the AppsetController WILL NOT pick the repo if the file does not contains certain valued needed by the template.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">argoproj.io/v1alpha1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ApplicationSet</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">devops</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">argocd</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">generators</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">matrix</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">generators</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">scmProvider</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">cloneProtocol</span>: <span style="color:#ae81ff">https</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">filters</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">branchMatch</span>: <span style="color:#ae81ff">^deployment$</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">pathsExist</span>:
</span></span><span style="display:flex;"><span>            - <span style="color:#ae81ff">deployments/argocd/qa.yaml</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">gitlab</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">allBranches</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">api</span>: <span style="color:#ae81ff">https://gitlab.mycompany.net/</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">group</span>: <span style="color:#ae81ff">devops</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">includeSubgroups</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">tokenRef</span>:
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">key</span>: <span style="color:#ae81ff">token</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">secretName</span>: <span style="color:#ae81ff">gitlab-token</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">matrix</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">generators</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">git</span>:
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">directories</span>:
</span></span><span style="display:flex;"><span>              - <span style="color:#f92672">path</span>: <span style="color:#ae81ff">deployments/k8s/overlays/qa/*</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">pathParamPrefix</span>: <span style="color:#ae81ff">repo</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">repoURL</span>: <span style="color:#e6db74">&#39;{{ .url }}&#39;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">requeueAfterSeconds</span>: <span style="color:#ae81ff">60</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">revision</span>: <span style="color:#e6db74">&#39;{{ .branch }}&#39;</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">git</span>:
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">files</span>:
</span></span><span style="display:flex;"><span>              - <span style="color:#f92672">path</span>: <span style="color:#ae81ff">deployments/k8s/config.yaml</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">pathParamPrefix</span>: <span style="color:#ae81ff">config</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">repoURL</span>: <span style="color:#e6db74">&#39;{{ .url }}&#39;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">requeueAfterSeconds</span>: <span style="color:#ae81ff">60</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">revision</span>: <span style="color:#e6db74">&#39;{{ .branch }}&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">goTemplate</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">preservedFields</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">annotations</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">environment</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">syncPolicy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">preserveResourcesOnDeletion</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#39;{{ $name := (printf &#34;%s-%s-%s&#34; .organization .repository .repo.path.basename)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        }}{{ $name | normalize }}&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">destination</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#39;{{ .repo.path.basename }}&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">namespace</span>: <span style="color:#e6db74">&#39;{{ .repository }}&#39;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">info</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Owner</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#39;{{.metadata.owner}}&#39;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Team</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#39;{{.metadata.team}}&#39;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Environment</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">value</span>: <span style="color:#ae81ff">qa</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Description</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#39;{{.metadata.description}}&#39;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">project</span>: <span style="color:#e6db74">&#39;{{.metadata.team}}&#39;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">source</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">path</span>: <span style="color:#ae81ff">deployments/k8s/overlays/qa/{{ .repo.path.basename }}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">repoURL</span>: <span style="color:#e6db74">&#39;{{ .url }}&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">targetRevision</span>: <span style="color:#e6db74">&#39;{{ .branch }}&#39;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">syncPolicy</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">automated</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">allowEmpty</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">prune</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">selfHeal</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">managedNamespaceMetadata</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">managedBy</span>: <span style="color:#ae81ff">argocd</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">origin</span>: <span style="color:#ae81ff">devops_cicd_argocd</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">syncOptions</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">CreateNamespace=true</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">ServerSideApply=true</span>
</span></span></code></pre></div><p>The <code>deployments/k8s/config.yaml</code> must contain something like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">owner</span>: <span style="color:#e6db74">&#34;infra&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">team</span>: <span style="color:#e6db74">&#34;infrastructure&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">description</span>: <span style="color:#e6db74">&#34;This is part of the GKE Cluster Addons&#34;</span>
</span></span></code></pre></div><p>And the <code>team</code> value must reflect an existing <code>App Project</code> that already exist in ArgoCD. In my case:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">argoproj.io/v1alpha1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">AppProject</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">annotations</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">meta.helm.sh/release-name</span>: <span style="color:#ae81ff">argocd</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">meta.helm.sh/release-namespace</span>: <span style="color:#ae81ff">argocd</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">finalizers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">resources-finalizer.argocd.argoproj.io</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">infrastructure</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">argocd</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">clusterResourceWhitelist</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">group</span>: <span style="color:#e6db74">&#39;*&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kind</span>: <span style="color:#e6db74">&#39;*&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">description</span>: <span style="color:#ae81ff">projects for Infrastructure Team</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">destinations</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">namespace</span>: <span style="color:#e6db74">&#39;*&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">server</span>: <span style="color:#e6db74">&#39;*&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">roles</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">description</span>: <span style="color:#ae81ff">Project Admin privileges to infrastructure project</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">groups</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">infrastructure@company.com</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">project-admin-infrastructure</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">policies</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">p, proj:infrastructure:project-admin, applicationsets, get, infrastructure/*,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ae81ff">allow</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">p, proj:infrastructure:project-admin, applications, get, infrastructure/*, allow</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">p, proj:infrastructure:project-admin, applications, sync, infrastructure/*,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ae81ff">allow</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">p, proj:infrastructure:project-admin, clusters, get, infrastructure/*, allow</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">p, proj:infrastructure:project-admin, repositories, get, infrastructure/*, allow</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">p, proj:infrastructure:project-admin, projects, get, infrastructure/*, allow</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">p, proj:infrastructure:project-admin, logs, get, infrastructure/*, allow</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">sourceRepos</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#e6db74">&#39;*&#39;</span>
</span></span></code></pre></div><p>Once deployed, a new <code>Application</code> will be created, and will deploy the content of the <code>deployments/overlays/qa/qa-us-central-cluster</code>, in our case, the <code>crossplane.yaml</code> file.</p>
<h2 id="the-appset-of-appset">The Appset of Appset</h2>
<p>The <code>crossplane.yaml</code> file contains another <code>ApplicationSet</code> that will be deployed, and generate new apps for each of the addons.</p>
<p>This Appset contains static values, because it is tied to this specific repo. This sounds a little dumb, but we&rsquo;ll discuss that at the end :)</p>
<p>So this time the cluster is a static list that I can manage for my addons. For example, this AppSet will only target the current repo, so we &ldquo;hardcode&rdquo; the URL&hellip;</p>
<p>Also, because this AppSet should only be deployed in the ArgoCD clusters, and not all of the clusters of your platform, we also grab the cluster names from the file&rsquo;s path.<br>
So the Git Generator is looking for <code>deployments/k8s/addons/qa/*/crossplane</code> so we explicitelly discover two folders:</p>
<ul>
<li>the name of the cluster</li>
<li>the name of the Addon (crossplane)</li>
</ul>
<p>The template also set a <code>ignoreDifferences</code> which is specific to Crossplane (as of today but PRed a change that was merged in the Helm Chart). This is the main reason I went to test this Appset-of-Appset pattern in the first place: Have each addons be configured with different values.</p>
<p>In theory, this Appset should only be used for Crossplane deployment. Let&rsquo;s say we want to deploy <code>VictoriaMetrics</code>, then we would have another Appset <code>victoriametrics.yaml</code> with hardcoded values for it. The Appset here is only used to auto-generate apps per cluster.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">argoproj.io/v1alpha1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ApplicationSet</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">annotations</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">addon-crossplane</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">argocd</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">generators</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">matrix</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">generators</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">list</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">elements</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">url</span>: <span style="color:#ae81ff">https://gitlab.mycompany.net/devops/argocd-infrastructure-addons.git</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">branch</span>: <span style="color:#ae81ff">deployment</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">env</span>: <span style="color:#ae81ff">qa</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">argocd</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">matrix</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">generators</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">git</span>:
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">directories</span>:
</span></span><span style="display:flex;"><span>              - <span style="color:#f92672">path</span>: <span style="color:#ae81ff">deployments/k8s/addons/qa/*/crossplane</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">pathParamPrefix</span>: <span style="color:#ae81ff">repo</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">repoURL</span>: <span style="color:#e6db74">&#39;{{ .url }}&#39;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">requeueAfterSeconds</span>: <span style="color:#ae81ff">60</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">revision</span>: <span style="color:#e6db74">&#39;{{ .branch }}&#39;</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">git</span>:
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">files</span>:
</span></span><span style="display:flex;"><span>              - <span style="color:#f92672">path</span>: <span style="color:#ae81ff">deployments/k8s/config.yaml</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">pathParamPrefix</span>: <span style="color:#ae81ff">config</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">repoURL</span>: <span style="color:#e6db74">&#39;{{ .url }}&#39;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">requeueAfterSeconds</span>: <span style="color:#ae81ff">60</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">revision</span>: <span style="color:#e6db74">&#39;{{ .branch }}&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">goTemplate</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">preservedFields</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">annotations</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">environment</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">syncPolicy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">preserveResourcesOnDeletion</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#39;{{ $name := (printf &#34;addons-%s-%s-%s&#34; .repo.path.basename .env (index .repo.path.segments 4))}}{{ $name | normalize }}&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">destination</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#39;{{ index .repo.path.segments 4 }}&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">namespace</span>: <span style="color:#e6db74">&#39;{{ .repo.path.basename }}&#39;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ignoreDifferences</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">group</span>: <span style="color:#ae81ff">apps</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">jqPathExpressions</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">.spec.template.spec.containers[].env[].valueFrom.resourceFieldRef.divisor</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">.spec.template.spec.initContainers[].env[].valueFrom.resourceFieldRef.divisor</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">info</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Owner</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#39;{{.metadata.owner}}&#39;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Team</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#39;{{.metadata.team}}&#39;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Environment</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">value</span>: <span style="color:#ae81ff">qa</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Description</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#39;{{.metadata.description}}&#39;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">val4</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#39;{{ index .repo.path.segments 4 }}&#39;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">val5</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#39;{{ index .repo.path.segments 5 }}&#39;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">project</span>: <span style="color:#e6db74">&#39;{{.metadata.team}}&#39;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">source</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">path</span>: <span style="color:#ae81ff">deployments/k8s/addons/{{ .env }}/{{ index .repo.path.segments 4 }}/{{ .repo.path.basename }}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">repoURL</span>: <span style="color:#e6db74">&#39;{{ .url }}&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">targetRevision</span>: <span style="color:#e6db74">&#39;{{ .branch }}&#39;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">syncPolicy</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">automated</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">allowEmpty</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">prune</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">selfHeal</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">managedNamespaceMetadata</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">wk/managedBy</span>: <span style="color:#ae81ff">argocd</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">wk/origin</span>: <span style="color:#ae81ff">devops_cicd_argocd</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">syncOptions</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">CreateNamespace=true</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">ServerSideApply=true</span>
</span></span></code></pre></div><h2 id="the-crossplane-kustomization">The Crossplane Kustomization</h2>
<p>The previous AppSet will, in turn, create an application that will deploy the content of <code>deployments/k8s/addons/qa/qa-us-central-cluster/crossplane/kustomization.yaml</code>.<br>
This file contains something like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">kustomize.config.k8s.io/v1beta1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Kustomization</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">../../../../base/crossplane</span>
</span></span></code></pre></div><p>And just as a hint, here&rsquo;s how I inflates the Crossplane Helm chart:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># kustomization.yaml from https://medium.com/@tharukam/generate-kubernetes-manifests-with-helm-charts-using-kustomize-2f82ab5c5f11</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># https://kubectl.docs.kubernetes.io/references/kustomize/builtins/#_helmchartinflationgenerator_</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">kustomize.config.k8s.io/v1beta1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Kustomization</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">helmCharts</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># https://github.com/crossplane/crossplane/tree/master/cluster/charts/crossplane</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># TODO to have it working:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># - enable helm in the argocd-cm ConfigMap by adding to the data: `kustomize.buildOptions: --load-restrictor LoadRestrictionsNone --enable-helm`</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># - enable some resources to be tracked by ArgoCD: &#34;Service&#34; and &#34;pkg.crossplane.io/*&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># - Update the projects application to not track some fields:</span>
</span></span><span style="display:flex;"><span>          <span style="color:#75715e"># ignoreDifferences:</span>
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">#   - group: apps</span>
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">#     kind: Deployment</span>
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">#     jqPathExpressions:</span>
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">#       - .spec.template.spec.containers[].env[].valueFrom.resourceFieldRef.divisor</span>
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">#       - .spec.template.spec.initContainers[].env[].valueFrom.resourceFieldRef.divisor</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">crossplane</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">repo</span>: <span style="color:#ae81ff">https://charts.crossplane.io/stable</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">releaseName</span>: <span style="color:#ae81ff">crossplane</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">crossplane</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># version: 0.1.0 # use latest</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">valuesFile</span>: <span style="color:#ae81ff">values.yaml</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">includeCRDs</span>: <span style="color:#66d9ef">false</span> <span style="color:#75715e">#no CRD in the chart, they are created by crossplane Operator</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">namespaces.yaml</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">providers.yaml</span>
</span></span></code></pre></div><p>Providers:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">pkg.crossplane.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Provider</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">provider-gcp-storage</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">annotations</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">argocd.argoproj.io/sync-wave</span>: <span style="color:#e6db74">&#34;2&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">package</span>: <span style="color:#ae81ff">xpkg.upbound.io/upbound/provider-gcp-storage:v0.41.0</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">pkg.crossplane.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Provider</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">provider-gcp-sql</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">annotations</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">argocd.argoproj.io/sync-wave</span>: <span style="color:#e6db74">&#34;2&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">package</span>: <span style="color:#ae81ff">xpkg.upbound.io/upbound/provider-gcp-sql:v0.41.0</span>
</span></span></code></pre></div><p>Namespace:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Namespace</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">annotations</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">argocd.argoproj.io/sync-options</span>: <span style="color:#ae81ff">ServerSideApply=true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">argocd.argoproj.io/sync-wave</span>: <span style="color:#e6db74">&#34;0&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kubernetes.io/metadata.name</span>: <span style="color:#ae81ff">crossplane</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">crossplane</span>
</span></span></code></pre></div><h2 id="conclusion">Conclusion</h2>
<p>Is it worth it ?</p>
<p>Yes and No&hellip;</p>
<p>Yes as a testing solution, and a way to further customize your Apps while still automating your setup.</p>
<p>No, as it is overly complicated and needs hardcoded values.</p>
<p>Of course, this is a specific case of Infrastructure buildup, not a pattern to give to Developers.<br>
While I tested this solution to go around an issue with the specific case of the Crossplane Helm Chart needing to ignore some part of the generated yaml, there&rsquo;s a new feature in the (upcoming) ArgoCD 2.10: <a href="https://blog.argoproj.io/argo-cd-v2-10-release-candidate-f69ba7bf9e06#0504">ApplicationSet Template Patch</a> !<br>
And if you read down to <code>Argo CD Server-Side Diff</code>, there&rsquo;s also a new diff algorythm that should prevent the issue with the Crossplane Helm Chart, without doing anything&hellip;</p>
<p>My conclusion: AppSet-of-AppSet works and could be used in some strange situations.</p>

      </div>
    </article>

    <hr />

    <div class="post-info">
      
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>

        <span class="tag"><a href="https://piratemakers.ca/tags/devops/">devops</a></span>
        <span class="tag"><a href="https://piratemakers.ca/tags/argocd/">argocd</a></span>
        <span class="tag"><a href="https://piratemakers.ca/tags/gitops/">gitops</a></span>
        
    </p>

      

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
        1400 Words
      </p>

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        
          2024-01-10 09:31
        

         
          
            
              (Last updated: 2024-01-10 10:38)
            
          
        
      </p>
        <p>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit">
            <circle cx="12" cy="12" r="4"></circle>
            <line x1="1.05" y1="12" x2="7" y2="12"></line>
            <line x1="17.01" y1="12" x2="22.96" y2="12"></line>
          </svg>

          <a href="1a9b78493444d6f0d4f528f2aa48658de0f9c2bc" target="_blank" rel="noopener">1a9b784</a>
          @ 2024-01-10
        </p>
    </div>
      <hr />
      <div class="sharing-buttons">
        
<a class="resp-sharing-button__link" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fpiratemakers.ca%2fposts%2f2024%2f01%2fargocd-appset-of-appset-pattern%2f" target="_blank" rel="noopener" aria-label="" title="Share on facebook">
  <div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://twitter.com/intent/tweet/?url=https%3a%2f%2fpiratemakers.ca%2fposts%2f2024%2f01%2fargocd-appset-of-appset-pattern%2f" target="_blank" rel="noopener" aria-label="" title="Share on twitter">
  <div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small">
      <div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://www.tumblr.com/widgets/share/tool?posttype=link&amp;title=ArgoCD%20Appset-of-Appset%20Pattern&amp;caption=ArgoCD%20Appset-of-Appset%20Pattern&amp;canonicalUrl=https%3a%2f%2fpiratemakers.ca%2fposts%2f2024%2f01%2fargocd-appset-of-appset-pattern%2f" target="_blank" rel="noopener" aria-label="" title="Share on tumblr">
  <div class="resp-sharing-button resp-sharing-button--tumblr resp-sharing-button--small">
    <div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.563 24c-5.093 0-7.031-3.756-7.031-6.411V9.747H5.116V6.648c3.63-1.313 4.512-4.596 4.71-6.469C9.84.051 9.941 0 9.999 0h3.517v6.114h4.801v3.633h-4.82v7.47c.016 1.001.375 2.371 2.207 2.371h.09c.631-.02 1.486-.205 1.936-.419l1.156 3.425c-.436.636-2.4 1.374-4.156 1.404h-.178l.011.002z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="mailto:?subject=ArgoCD%20Appset-of-Appset%20Pattern&amp;body=https%3a%2f%2fpiratemakers.ca%2fposts%2f2024%2f01%2fargocd-appset-of-appset-pattern%2f" target="_self" rel="noopener" aria-label="" title="Share via email">
  <div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://pinterest.com/pin/create/button/?url=https%3a%2f%2fpiratemakers.ca%2fposts%2f2024%2f01%2fargocd-appset-of-appset-pattern%2f&amp;media=https%3a%2f%2fpiratemakers.ca%2fposts%2f2024%2f01%2fargocd-appset-of-appset-pattern%2f;description=ArgoCD%20Appset-of-Appset%20Pattern" target="_blank" rel="noopener" aria-label="" title="Share on pinterest">
  <div class="resp-sharing-button resp-sharing-button--pinterest resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M12.017 0C5.396 0 .029 5.367.029 11.987c0 5.079 3.158 9.417 7.618 11.162-.105-.949-.199-2.403.041-3.439.219-.937 1.406-5.957 1.406-5.957s-.359-.72-.359-1.781c0-1.663.967-2.911 2.168-2.911 1.024 0 1.518.769 1.518 1.688 0 1.029-.653 2.567-.992 3.992-.285 1.193.6 2.165 1.775 2.165 2.128 0 3.768-2.245 3.768-5.487 0-2.861-2.063-4.869-5.008-4.869-3.41 0-5.409 2.562-5.409 5.199 0 1.033.394 2.143.889 2.741.099.12.112.225.085.345-.09.375-.293 1.199-.334 1.363-.053.225-.172.271-.401.165-1.495-.69-2.433-2.878-2.433-4.646 0-3.776 2.748-7.252 7.92-7.252 4.158 0 7.392 2.967 7.392 6.923 0 4.135-2.607 7.462-6.233 7.462-1.214 0-2.354-.629-2.758-1.379l-.749 2.848c-.269 1.045-1.004 2.352-1.498 3.146 1.123.345 2.306.535 3.55.535 6.607 0 11.985-5.365 11.985-11.987C23.97 5.39 18.592.026 11.985.026L12.017 0z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fpiratemakers.ca%2fposts%2f2024%2f01%2fargocd-appset-of-appset-pattern%2f&amp;title=ArgoCD%20Appset-of-Appset%20Pattern&amp;summary=ArgoCD%20Appset-of-Appset%20Pattern&amp;source=https%3a%2f%2fpiratemakers.ca%2fposts%2f2024%2f01%2fargocd-appset-of-appset-pattern%2f" target="_blank" rel="noopener" aria-label="" title="Share on linkedin">
  <div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://reddit.com/submit/?url=https%3a%2f%2fpiratemakers.ca%2fposts%2f2024%2f01%2fargocd-appset-of-appset-pattern%2f&amp;resubmit=true&amp;title=ArgoCD%20Appset-of-Appset%20Pattern" target="_blank" rel="noopener" aria-label="" title="Share on reddit">
  <div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://www.xing.com/app/user?op=share;url=https%3a%2f%2fpiratemakers.ca%2fposts%2f2024%2f01%2fargocd-appset-of-appset-pattern%2f;title=ArgoCD%20Appset-of-Appset%20Pattern" target="_blank" rel="noopener" aria-label="" title="Share on xing">
  <div class="resp-sharing-button resp-sharing-button--xing resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M18.188 0c-.517 0-.741.325-.927.66 0 0-7.455 13.224-7.702 13.657.015.024 4.919 9.023 4.919 9.023.17.308.436.66.967.66h3.454c.211 0 .375-.078.463-.22.089-.151.089-.346-.009-.536l-4.879-8.916c-.004-.006-.004-.016 0-.022L22.139.756c.095-.191.097-.387.006-.535C22.056.078 21.894 0 21.686 0h-3.498zM3.648 4.74c-.211 0-.385.074-.473.216-.09.149-.078.339.02.531l2.34 4.05c.004.01.004.016 0 .021L1.86 16.051c-.099.188-.093.381 0 .529.085.142.239.234.45.234h3.461c.518 0 .766-.348.945-.667l3.734-6.609-2.378-4.155c-.172-.315-.434-.659-.962-.659H3.648v.016z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="whatsapp://send?text=ArgoCD%20Appset-of-Appset%20Pattern%20https%3a%2f%2fpiratemakers.ca%2fposts%2f2024%2f01%2fargocd-appset-of-appset-pattern%2f" target="_blank" rel="noopener" aria-label="" title="Share on whatsapp">
  <div class="resp-sharing-button resp-sharing-button--whatsapp resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fpiratemakers.ca%2fposts%2f2024%2f01%2fargocd-appset-of-appset-pattern%2f&amp;t=ArgoCD%20Appset-of-Appset%20Pattern" target="_blank" rel="noopener" aria-label="" title="Share on hacker news">
  <div class="resp-sharing-button resp-sharing-button--hackernews resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
			<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M0 24V0h24v24H0zM6.951 5.896l4.112 7.708v5.064h1.583v-4.972l4.148-7.799h-1.749l-2.457 4.875c-.372.745-.688 1.434-.688 1.434s-.297-.708-.651-1.434L8.831 5.896h-1.88z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://telegram.me/share/url?text=ArgoCD%20Appset-of-Appset%20Pattern&amp;url=https%3a%2f%2fpiratemakers.ca%2fposts%2f2024%2f01%2fargocd-appset-of-appset-pattern%2f" target="_blank" rel="noopener" aria-label="" title="Share on telegram">
  <div class="resp-sharing-button resp-sharing-button--telegram resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
    </div>
  </div>
</a>

      </div>

    
    <div class="pagination">
        

        <div class="pagination__buttons">
            
            <span class="button previous">
                <a href="https://piratemakers.ca/posts/2024/02/crossplane-review-after-1.5-years/">
                    <span class="button__icon">←</span>
                    <span class="button__text">Crossplane: review after 1.5 years</span>
                </a>
            </span>
            

            
            <span class="button next">
                <a href="https://piratemakers.ca/posts/2022/11/docker.io-opensource-fail-and-what-to-do-instead/">
                    <span class="button__text">Docker.io &amp; OpenSource Fail (and what to do instead)</span>
                    <span class="button__icon">→</span>
                </a>
            </span>
            
        </div>
    </div>


    
      
        <div id="comments">
          <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "piratemakers-ca" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </div>
      
    

    

    

  </main>

            </div>

            
                <footer class="footer">
    
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2023</span>
            
            <span><a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></span>
            <span><a href="https://piratemakers.ca/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
            <span>Pirate Makers™</span>
        </div>
    </div>
    
    
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
        </div>
    </div>
    
</footer>

            
        </div>

        



<script type="text/javascript" src="https://piratemakers.ca/bundle.min.46e438bd2eca7eb6358c700b40f6f56b22ab0b92503ecc11a2d8e4bcc610b8b4da83e5ea3d3e84fdb5f3c3c765744b9f5bbaf43cf5a027910be07ee39a9c12a1.js" integrity="sha512-RuQ4vS7KfrY1jHALQPb1ayKrC5JQPswRotjkvMYQuLTag&#43;XqPT6E/bXzw8dldEufW7r0PPWgJ5EL4H7jmpwSoQ=="></script>




    </body>
</html>
